import{n as T,E as D,P as O,F as S,Q as $,G as I,r as c,H as R,f as Q,o as b,y as t,z as j,w as s,b as a,J as q,c as G,e as H,a as l,R as P,t as F,K as J,L as z,p as U,U as W,N as X}from"../index54848.js";import{T as C,u as Y,_ as Z}from"./LazyDataTable.vue_vue_type_script_setup_true_lang54848.js";import{u as B,C as L,a as y,b as ee,c as te}from"./useClaimStore54848.js";const ae={class:"flex items-center gap-2"},oe={key:0,class:"flex items-center gap-2"},se={class:"flex items-center justify-center"},le=T({__name:"CqpsTable",setup(k){const i=B(),v=D();let n=O({insured_full_name:{value:"",matchMode:C.LIKE},insured_fiscal_code:{value:"",matchMode:C.LIKE},status:{value:null,matchMode:C.EQ},partner_id:{value:null,matchMode:C.EQ}});const{isLoading:m,tableRows:p,onPage:w,onSort:g,onFilter:_,loadLazyData:r}=Y({rows:20},x),M=S(()=>i.allCqps),f=S(()=>i.totalCqps);async function x(V){await i.fetchCqps(V)}return $(()=>v.getCurrentUserPartner,()=>{r()}),I(async()=>{await r()}),(V,h)=>{const u=c("Column"),E=c("InputText"),K=c("Select"),N=c("Button"),A=R("tooltip");return b(),Q(Z,{"total-records":f.value,value:M.value,loading:t(m),rows:t(p),filters:t(n),"onUpdate:filters":h[0]||(h[0]=e=>j(n)?n.value=e:n=e),onPage:t(w),onSort:t(g),onFilter:h[1]||(h[1]=()=>t(_)(t(n))),"empty-message":"Nessuna richiesta CQP trovata."},{default:s(()=>[a(u,{field:"insured_document_number",header:"Numero documento",sortable:!0}),a(u,{field:"insured_fiscal_code",header:"Codice fiscale",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:d})=>[a(E,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:q(o=>d(),["enter"]),placeholder:"Filtra per codice fiscale"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),a(u,{field:"insured_full_name",header:"Assicurato",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:d})=>[a(E,{type:"text",modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,onKeydown:q(o=>d(),["enter"]),placeholder:"Filtra per nome e cognome"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),a(u,{class:"w-[200px] min-w-[200px]",field:"partner.name","filter-field":"partner_id",header:"Partner",sortable:!0}),a(u,{field:"status",header:"Stato",sortable:!0,showFilterMatchModes:!1,showFilterOperator:!1,showFilterMenu:!1},{filter:s(({filterModel:e,filterCallback:d})=>[a(K,{modelValue:e.value,"onUpdate:modelValue":o=>e.value=o,options:[...t(ee)],optionLabel:o=>t(y)[o],placeholder:"Filtra per stato",showClear:"",onChange:o=>d()},{option:s(({option:o})=>[l("div",ae,[l("span",{class:P(["status-dot",t(L)[o]])},null,2),l("span",null,F(t(y)[o]),1)])]),_:1},8,["modelValue","onUpdate:modelValue","options","optionLabel","onChange"])]),body:s(({data:e})=>[e.status?(b(),G("div",oe,[l("span",{class:P(["status-dot",t(L)[e.status]])},null,2),l("span",null,F(t(y)[e.status]),1)])):H("",!0)]),_:1}),a(u,{class:"w-[50px]",alignFrozen:"right",frozen:""},{body:s(({data:e})=>[l("div",se,[J(a(N,{size:"small",type:"button",icon:"pi pi-arrow-right",text:"",rounded:"",as:"router-link",to:{name:t(z).CQP_DETAIL,params:{id:e.id}}},null,8,["to"]),[[A,"Dettaglio",void 0,{top:!0}]])])]),_:1})]),_:1},8,["total-records","value","loading","rows","filters","onPage","onSort"])}}}),ne={class:"flex flex-row flex-wrap gap-2 justify-between"},re={class:"flex gap-2"},pe=T({__name:"CqpsViews",setup(k){const i=B(),v=te(),n=S(()=>i.totalCqps),m=U(),p=U(!1),w=[{label:"Contratti non perfezionati",command:()=>_("cqp")},{label:"Sinistri",command:()=>_("claim")}];function g(r){m.value?.toggle(r)}async function _(r){p.value=!0,await X(()=>r==="cqp"?i.downloadCqpExport():v.downloadClaimExport(),{onFinally:()=>p.value=!1})}return(r,M)=>{const f=c("Button"),x=c("Card");return b(),Q(x,{class:"main-margin"},{title:s(()=>[l("div",ne,[l("h2",null,F(n.value)+" CQP",1),l("div",re,[a(f,{icon:"pi pi-file-export",label:"Estrazione",severity:"primary",outlined:"",loading:p.value,onClick:g},null,8,["loading"]),a(t(W),{ref_key:"exportMenu",ref:m,model:w,popup:!0},null,512),a(f,{label:"Nuovo",icon:"pi pi-plus",as:"router-link",to:{name:t(z).CQP_NEW}},null,8,["to"])])])]),content:s(()=>[a(le)]),_:1})}}});export{pe as default};
